回顾：

1、MixedGC参数介绍——堆内存分配相关内容

（1）参数-XX:InitiatingHeapOccupancyPercent 默认值为45，也就是45%

（2）参数-XX:G1ReservePercent 默认值10，也就是10%

（3）参数-XX:G1HeapWastePercent 默认5%

 

本节内容:

1、-XX:ParallelGCThreads 这个参数是指定并行 GC 线程的数量，一般最好和 CPU 核心数量相当，如果不设置的话，会自动推断。计算公式是：

当 CPU 数量小于8， ParallelGCThreads 的值等于 CPU 数量，当 CPU 数量大于 8 时，则使用公式：ParallelGCThreads = 8 + ((N - 8) * 5/8) = 3 +（（5*CPU）/ 8）

注意：这个值是说，并行执行GC操作的时候有多少个线程参与，并行执行的阶段，可以理解为处于STW过程中的阶段，这个阶段系统程序完成停止，多个线程并行处理GC相关的任务，比如标记、清理等等。

 

2、参数ConcGCThreads，默认值为0。这个参数的含义是GC并发过程中的线程数量，如果没有设置的话，这个值会自动调整，调整的依据是(ParallelGCThreads + 2)/4，最小值为1，也就是至少为1个GC线程。

假如说服务器是4C的，那计算出来得到的值就是，（4+2）/ 4 = 1，也就是一个线程在工作。

那么就是默认一个线程执行在并发过程中起作用。如果说我们发现并发过程速度比较慢的话，可以考虑增大该值。对于这个值，也要慎重调节，因为这个值如果调的过大的话，会导致系统程序的吞吐量下降。

导致系统程序吞吐量下降的原因其实也很简单，因为这个并发线程数是说，这个线程所处的阶段，系统是可以执行的，也就是GC过程中的非STW阶段。那也就是说，这个线程的数量越多，在程序和并发线程共同工作的时候，系统程序可以使用的CPU资源，或者说线程资源就越少，这肯定是会导致系统吞吐量下降的。

 

3、-XX:HeapSizePerGCThread=，默认值为64。这个参数的含义是，在GC过程中，每个线程处理的空间大小。也可以简单的理解为，每64MB的空间就分配一个线程去处理。

关于这个参数主要是要看服务器的计算能力。这个计算能力就不单单要考虑是多少核了。而是处理器本身的能力是否强大。用大家比较容易理解的话来说就是，I3处理器，I5处理器，I7处理器，假如都是4核，那肯定是I7处理器的计算性能更好一些。

不过因为我们使用的服务器多数是不需要考虑核心的计算性能的，所以一般这个参数的值就保持默认值就可以了，不需要做特别的调整。

 

4、参数-XX:-UseDynamicNumberOfGCThreads，默认为false。这个参数的含义是，默认不能动态调整线程数量。如果开启的话，则会按照最大线程数、HeapSizePerGCThread来动态调整。正常来说关闭即可，因为开启这个参数带来的收益非常有限，普通的4C 16C 的机器还是目前服务器的主流，即使开启了这个参数其实也没有多大意义。反而有可能因为动态调整的判定逻辑导致JVM需要额外消耗一部分性能去动态调整这个值。

 

5、-XX:G1SATBBufferSize=，默认值1K，表示每个SATB队列最多存放1000个灰色对象。我们前面见过SATB queue set，这个set本身是有长度的。这里特别强调一点，G1SATBBufferSize这个值不是SATB queue set的大小。

这个参数正常来说也不需要修改，因为对整体性能没什么影响。

6、参数-XX:G1OldCSetRegionThresholdPercent=，默认值是 Java 堆的 10%，这个参数表示，每轮Mixed GC回收的Region最大比例，也就是说，如果说执行了MixedGC回收，总共8轮，那么每轮不能回收超过堆内存10%的region数量。假如说我们在设置停顿时间的时候设置的比较短，每次的值可能会远远低于这个10%，这个参数一般也不需要做调整，保持默认即可。

 

7、参数-XX:GCDrainStackTargetSize=，默认值为64。这个参数表示并发标记阶段，一次最多能标记多少个对象。出于性能考虑，这个值不宜过大，也不宜过小。和HeapSizePerGCThread参数类似，也要基于处理器的运算能力，运算能力强的话，可以适当提高这个参数的值，能一定程度上提升并发标记过程的效率